# JPQL ë¬¸ë²•

ê¸°ë³¸ SQLë¬¸ë²•ê³¼ ë™ì¼

- select ë¬¸::=
- update ë¬¸::=
- delete ë¬¸::=

## JPQL íŠ¹ì§•

```java
select m from Member as m where m.age  > 18
```

- ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤.
- ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì„ í•œë‹¤.
- JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤(SELECT, FROM, where)
- ì—”í‹°í‹° ì´ë¦„ ì‚¬ìš©, í…Œì´ë¸” ì´ë¦„ì´ ì•„ë‹˜(Member)
- **ë³„ì¹­ì€ í•„ìˆ˜(`alias`)** (asëŠ” ìƒëµ ê°€ëŠ¥)

ğŸ’¡ì§‘í•©ê³¼ ì •ë ¬

- count(m), sum(m.age), avg(m.age), max(m.age), min(m.age)
- group by, having

> TypeQuery, Query
> 
- TypeQuery: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©
    
    ```java
    TypedQuery<Member> query = em.createQuery("SELECT m FROM Meber m", Member.class);
    ```
    
- Query: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©

```java
Query query = em.createQuery("SELECT m.username, m.age FROM Meber m");
```

> ê²°ê³¼ ì¡°íšŒ API
> 
- query.getResultList(): ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
- query.getSingleResult(): ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜
ê²°ê³¼ê°€ í•˜ë‚˜ë§Œ ë‚˜ì˜¤ëŠ” ê²ƒ ì™¸ì˜ ëª¨ë“  ìƒí™©ì—ì„œ ì—ëŸ¬ê°€ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì— ì£¼ì˜ê°€ í•„ìš”.
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´: javax.persistence.NoResultException
    - ë‘˜ ì´ìƒì´ë©´: javax.persistence.NonUniqueResultException

> íŒŒë¼ë¯¸í„° ë°”ì¸ë”© - ì´ë¦„ ê¸°ì¤€
â“ìœ„ì¹˜ê¸°ë°˜ì˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë„ ìˆì§€ë§Œ ì¶”ì²œí•˜ì§€ ì•ŠëŠ”ë‹¤.
> 

```java
/*Usercase - 1*/
SELECT m FROM Member m where m.username = :username
query.setParameter("username" usernameParam);

/*Usecase - 2 ìœ„ì¹˜ ê¸°ë°˜*/
SELECT m FROM Member m where m.username = ?1
query.setParameter(1, usernameParam);
```

# í”„ë¡œì ì…˜(SELECT)

---

- SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
- í”„ë¡œì ì…˜ ëŒ€ìƒ: ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼ íƒ€ì…(ìˆ«ì, ë¬¸ìë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…)
- SELECT **m** FROM Member m â†’ ì—”í‹°í‹° í”„ë¡œì ì…˜
- SELECT **m. team**  FROM Member m â†’ ì—”í‹°í‹° í”„ë¡œì ì…˜
- SELECT **m** .address FROM Member m â†’ ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜
- SELECT **m.username, m.age**  FROM Member m â†’ ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜
- DISTINCTë¡œ ì¤‘ë³µ ì œê±°

### **ğŸ’¡ë¬µì‹œì  ì¡°ì¸, ëª…ì‹œì  ì¡°ì¸**

- **ë¬µì‹œì  ì¡°ì¸**
    
    ```java
    List<Team> result = em.createQuery("select m.team from Member m", Team.calss)
    //SQL: SELECT t.id, t.name FROM Member m inner join TEAM t on m.team_id = t.id
    ```
    
    ìœ„ ì½”ë“œì²˜ëŸ¼ JPQLì—ëŠ” JOINë¬¸ë²•ì´ ì—†ì§€ë§Œ ìì—°ìŠ¤ëŸ½ê²Œ JOINì„ í•´ì„œ Team Entityë¥¼ ì¡°íšŒí•´ ì˜¨ë‹¤.
    
- **ëª…ì‹œì  ì¡°ì¸**
    
    ```java
    List<Team> result = em.createQuery("select t from Member m join m.team t", Team.calss)
    //SQL: SELECT t.id, t.name FROM Member m inner join TEAM t on m.team_id = t.id
    ```
    
    ì‹¤í–‰ë˜ëŠ” SQLì€ ë™ì¼í•˜ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ JPQLì— ì ì–´ì¤¬ê¸°ì— ê°€ë…ì„±ì´ ë†’ì•„ì§€ê³  JOIN ì¿¼ë¦¬ê°€ ë‚ ì•„ê°€ê² ë‹¤ê³  ì˜ˆì¸¡ì´ ê°€ëŠ¥í•˜ë‹¤. 
    
- ë¬µì‹œì  ì¡°ì¸ë³´ë‹¤ëŠ” ëª…ì‹œì  ì¡°ì¸ì„ í•˜ëŠ”ê²Œ ì¢‹ë‹¤.

### â“ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜

```java
em.createQuery("select o.address from Order o", Address.calss).getRresultList();
//SQL: SELECT o.city, o.street, o.zipcode FROM ORDERS o
```

ì„ë² ë””ë“œ íƒ€ì…ì€ ë”°ë¡œ ì¡°ì¸ì„ í•´ì„œ ê°€ì ¸ì˜¤ì§€ëŠ” ì•ŠëŠ”ë‹¤. 

ë‹¤ë§Œ,fromì ˆì— Orderê°€ ì•„ë‹Œ Addressë¥¼ ì ìœ¼ë©´ ì—ëŸ¬ê°€ë‚œë‹¤. ì—”í‹°í‹°ë¡œë¶€í„° ì‹œì‘ë˜ì•¼ í•œë‹¤.

### â“ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜ / ì—¬ëŸ¬ ê°’ ì¡°íšŒ

â‡’ ìŠ¤ì¹¼ë¼íƒ€ì…ìœ¼ë¡œ ì¡°íšŒë¥¼ í• ë•Œ ê°’ì„ ì–´ë–»ê²Œ ì €ì¥í•´ì„œ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?

```java
em.createQuery("select distinct m.address, m.age from Member m").getRresultList();
```

1. Query íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ
2. Object[] íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ
3. new ëª…ë ¹ì–´ë¡œ ì¡°íšŒ
    - ë‹¨ìˆœ ê°’ì„ DTOë¡œ ë°”ë¡œ ì¡°íšŒ
    
    ```java
    SELECT new jpabook.jpql.UserDTO(m.username, m.age)from Memer m;
    ```
    
    - íŒ¨í‚¤ì§€ ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª…ì„ ì ì–´ì¤˜ì•¼ í•œë‹¤.
    - ìˆœì‚¬ì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”.
